<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khám phá Hình học Tứ giác</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #eceff1; margin: 0; padding: 0; overflow: hidden; }
        .wrapper { display: flex; height: 100vh; width: 100vw; }
        
        /* Cột trái: Hình vẽ - Tăng không gian hiển thị */
        .visual-section { flex: 1.4; background: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; border-right: 2px solid #cfd8dc; }
        canvas { cursor: crosshair; }

        /* Cột phải: Câu hỏi */
        .quiz-section { flex: 0.6; padding: 30px; overflow-y: auto; background: #f8f9fa; }
        .panel-title { font-weight: bold; font-size: 1.2em; color: #1a3a5f; border-bottom: 2px solid #3498db; margin-bottom: 20px; padding-bottom: 10px; display: block; }
        
        .question { margin-bottom: 25px; padding: 20px; border-radius: 12px; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .question p { margin: 0 0 15px 0; line-height: 1.6; font-weight: 500; }
        
        .result { margin-top: 12px; font-weight: 500; font-size: 0.95em; line-height: 1.4; }
        .correct { color: #27ae60; }
        .incorrect { color: #e74c3c; }
        
        input[type="number"] { width: 80px; padding: 8px; border: 1px solid #bdc3c7; border-radius: 6px; }
        button { padding: 8px 20px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: #2980b9; }

        .options { display: flex; flex-direction: column; gap: 12px; margin-bottom: 15px; }
        .option-item { display: flex; align-items: center; font-size: 1.1em; cursor: pointer; }
        .option-item input { margin-right: 12px; transform: scale(1.2); }
        
        .instruction { color: #1a3a5f; font-weight: bold; font-size: 1.15em; margin-top: 30px; }
    </style>
</head>
<body>

    <div class="wrapper">
        <div class="visual-section">
            <canvas id="canvas" width="750" height="550"></canvas>
            <p class="instruction">Em hãy di chuyển các đỉnh để quan sát sự thay đổi của hình!</p>
        </div>

        <div class="quiz-section">
            <span class="panel-title">CÂU HỎI</span>
            <div class="question">
                <p><b>Câu 1:</b> Gọi T1, T2 lần lượt là tổng các góc của tam giác ABC và tam giác ADC. Tổng <b>T1 + T2</b> bằng bao nhiêu độ?</p>
                Trả lời: <input type="number" id="q1-input" placeholder="..."> <b>°</b> 
                <button onclick="checkQ1()" style="margin-left: 10px;">Gửi</button>
                <div id="res1" class="result"></div>
            </div>

            <div class="question">
                <p><b>Câu 2:</b> Gọi T là tổng các góc của tứ giác ABCD. So sánh <b>T</b> với <b>(T1 + T2)</b>:</p>
                <div class="options">
                    <label class="option-item"><input type="radio" name="q2" value="A"> A. T  &gt;  (T1 + T2)</label>
                    <label class="option-item"><input type="radio" name="q2" value="B"> B. T  &lt;  (T1 + T2)</label>
                    <label class="option-item"><input type="radio" name="q2" value="C"> C. T  =  (T1 + T2)</label>
                </div>
                <button onclick="checkQ2()">Gửi</button>
                <div id="res2" class="result"></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const RATIO = 45; // Tăng tỷ lệ cm để hình to hơn

        let points = [
            { x: 180, y: 100, label: 'A' },
            { x: 580, y: 120, label: 'B' },
            { x: 530, y: 420, label: 'C' },
            { x: 120, y: 380, label: 'D' }
        ];

        let dragPoint = null;
        const dist = (p1, p2) => Math.sqrt((p1.x - p2.x)**2 + (p1.y - p2.y)**2);
        const toDeg = (rad) => (rad * 180 / Math.PI).toFixed(1);

        function getAngle(p1, p2, p3) {
            let a = dist(p2, p3), b = dist(p1, p3), c = dist(p1, p2);
            return Math.acos(Math.max(-1, Math.min(1, (a*a + c*c - b*b) / (2 * a * c))));
        }

        function drawAngleText(pVertex, p1, p2, text, color, offset = 55) {
            const ang1 = Math.atan2(p1.y - pVertex.y, p1.x - pVertex.x);
            const ang2 = Math.atan2(p2.y - pVertex.y, p2.x - pVertex.x);
            let midAng = (ang1 + ang2) / 2;
            if (Math.abs(ang1 - ang2) > Math.PI) midAng += Math.PI;
            
            const tx = pVertex.x + Math.cos(midAng) * offset;
            const ty = pVertex.y + Math.sin(midAng) * offset;
            
            ctx.fillStyle = color;
            ctx.fillText(text + "°", tx - 18, ty);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const [A, B, C, D] = points;

            ctx.beginPath(); ctx.moveTo(A.x, A.y); ctx.lineTo(B.x, B.y); ctx.lineTo(C.x, C.y); ctx.closePath();
            ctx.fillStyle = 'rgba(52, 152, 219, 0.1)'; ctx.fill();
            ctx.strokeStyle = '#2980b9'; ctx.setLineDash([]); ctx.lineWidth = 2.5; ctx.stroke();

            ctx.beginPath(); ctx.moveTo(A.x, A.y); ctx.lineTo(C.x, C.y); ctx.lineTo(D.x, D.y); ctx.closePath();
            ctx.fillStyle = 'rgba(230, 126, 34, 0.1)'; ctx.fill();
            ctx.strokeStyle = '#e67e22'; ctx.stroke();

            ctx.beginPath(); ctx.setLineDash([6, 5]);
            ctx.moveTo(A.x, A.y); ctx.lineTo(C.x, C.y);
            ctx.strokeStyle = '#95a5a6'; ctx.stroke(); ctx.setLineDash([]);

            ctx.font = "14px Arial"; ctx.fillStyle = "#000";
            const sides = [{p1: A, p2: B, off: -22}, {p1: B, p2: C, off: 32}, {p1: C, p2: D, off: 32}, {p1: D, p2: A, off: -22}];
            sides.forEach(s => {
                let midX = (s.p1.x + s.p2.x)/2, midY = (s.p1.y + s.p2.y)/2;
                let ang = Math.atan2(s.p2.y - s.p1.y, s.p2.x - s.p1.x);
                ctx.fillText((dist(s.p1, s.p2)/RATIO).toFixed(1) + "cm", midX + Math.cos(ang-Math.PI/2)*s.off - 15, midY + Math.sin(ang-Math.PI/2)*s.off);
            });

            ctx.font = "bold 12px Arial";
            drawAngleText(A, B, C, toDeg(getAngle(B, A, C)), "#2980b9", 65);
            drawAngleText(A, C, D, toDeg(getAngle(C, A, D)), "#e67e22", 65);
            drawAngleText(C, B, A, toDeg(getAngle(B, C, A)), "#2980b9", 65);
            drawAngleText(C, A, D, toDeg(getAngle(A, C, D)), "#e67e22", 65);
            
            ctx.fillStyle = "#000";
            drawAngleText(B, A, C, toDeg(getAngle(A, B, C)), "#000", 45);
            drawAngleText(D, A, C, toDeg(getAngle(A, D, C)), "#000", 45);

            points.forEach(p => {
                ctx.beginPath(); ctx.arc(p.x, p.y, 7, 0, Math.PI * 2);
                ctx.fillStyle = '#000'; ctx.fill();
                ctx.font = "bold 22px Arial";
                let lx = p.x < 375 ? p.x - 35 : p.x + 20;
                let ly = p.y < 275 ? p.y - 20 : p.y + 35;
                ctx.fillText(p.label, lx, ly);
            });
        }

        canvas.onmousedown = (e) => {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left, my = e.clientY - rect.top;
            points.forEach(p => { if (dist({x: mx, y: my}, p) < 30) dragPoint = p; });
        };
        window.onmousemove = (e) => {
            if (dragPoint) {
                const rect = canvas.getBoundingClientRect();
                dragPoint.x = Math.max(60, Math.min(canvas.width-60, e.clientX - rect.left));
                dragPoint.y = Math.max(60, Math.min(canvas.height-60, e.clientY - rect.top));
                draw();
            }
        };
        window.onmouseup = () => dragPoint = null;

        function checkQ1() {
            const val = document.getElementById('q1-input').value;
            const res = document.getElementById('res1');
            const msg = "Tổng 3 góc của 1 tam giác luôn luôn bằng 180° => T1 + T2 = 180° + 180° = 360°.";
            if(val == 360) { res.innerHTML = "Em đã làm chính xác, " + msg; res.className = "result correct"; }
            else { res.innerHTML = msg; res.className = "result incorrect"; }
        }

        function checkQ2() {
            const sel = document.querySelector('input[name="q2"]:checked');
            const res = document.getElementById('res2');
            if(!sel) return;
            const msg = "Tổng các góc của 1 tứ giác luôn luôn bằng 360° nên T = T1 + T2.";
            if(sel.value === 'C') { res.innerHTML = "Em đã làm chính xác, " + msg; res.className = "result correct"; }
            else { res.innerHTML = msg; res.className = "result incorrect"; }
        }
        draw();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Toán 8 - Tứ giác ABCD</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); max-width: 1000px; width: 100%; }
        
        .layout { display: flex; gap: 20px; }
        .visual-box { flex: 1; background: #fff; border: 1px solid #ddd; border-radius: 10px; position: sticky; top: 10px; height: fit-content; }
        
        /* Cấu trúc dấu mũ góc chuẩn TOÁN HỌC */
        .goc-wrapper { position: relative; display: inline-block; }
        .goc-hat { 
            position: absolute; top: -12px; left: 50%; transform: translateX(-50%) scale(3, 0.8); 
            color: white; /* Màu trắng theo ý bạn */
            font-size: 20px; font-weight: 100; pointer-events: none;
        }

        /* Highline khi đúng */
        .hl-active { stroke: #ff0000 !important; stroke-width: 7 !important; transition: 0.3s; }
        .hl-point-active { fill: #ff0000 !important; r: 10 !important; transition: 0.3s; }
        .hl-diag-active { stroke: #ff0000 !important; stroke-width: 5 !important; stroke-dasharray: none !important; transition: 0.3s; }

        /* Kéo thả */
        .content-box { flex: 1.3; }
        .items-pool { display: flex; flex-wrap: wrap; gap: 8px; border: 2px dashed #3498db; padding: 15px; border-radius: 10px; min-height: 80px; margin-bottom: 15px; background: #fafafa; }
        .draggable { background: #3498db; color: white; padding: 10px 14px; border-radius: 6px; cursor: move; font-weight: bold; font-size: 15px; user-select: none; transition: 0.2s; }
        
        .dropzone-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .dropzone { background: #fff; border: 2px solid #e0e0e0; padding: 10px; border-radius: 8px; min-height: 75px; }
        .dropzone h4 { margin: 0 0 8px 0; font-size: 0.85rem; color: #555; background: #e9ecef; padding: 4px 10px; border-radius: 4px; border-left: 4px solid #3498db; }
        
        .correct { background-color: #28a745 !important; border-color: #1e7e34; }
        .wrong { background-color: #dc3545 !important; border-color: #bd2130; }
        
        button { width: 100%; padding: 15px; background: #2c3e50; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: bold; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button:active { transform: translateY(2px); }
        #msg { text-align: center; margin-top: 15px; font-weight: bold; min-height: 24px; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color: #2c3e50;">NHẬN BIẾT TỨ GIÁC ABCD</h2>
    <div class="layout">
        <div class="visual-box">
            <svg viewBox="0 0 400 350">
                <line id="svg-AC" x1="80" y1="80" x2="320" y2="200" stroke="#eee" stroke-dasharray="5" stroke-width="2" />
                <line id="svg-BD" x1="280" y1="60" x2="120" y2="280" stroke="#eee" stroke-dasharray="5" stroke-width="2" />
                <line id="svg-AB" x1="80" y1="80" x2="280" y2="60" stroke="#444" stroke-width="3" />
                <line id="svg-BC" x1="280" y1="60" x2="320" y2="200" stroke="#444" stroke-width="3" />
                <line id="svg-CD" x1="320" y1="200" x2="120" y2="280" stroke="#444" stroke-width="3" />
                <line id="svg-DA" x1="120" y1="280" x2="80" y2="80" stroke="#444" stroke-width="3" />
                <circle id="svg-A" cx="80" cy="80" r="6" fill="#1a73e8" />
                <circle id="svg-B" cx="280" cy="60" r="6" fill="#1a73e8" />
                <circle id="svg-C" cx="320" cy="200" r="6" fill="#1a73e8" />
                <circle id="svg-D" cx="120" cy="280" r="6" fill="#1a73e8" />
                <text x="50" y="85" font-size="24" font-weight="bold">A</text>
                <text x="290" y="55" font-size="24" font-weight="bold">B</text>
                <text x="335" y="215" font-size="24" font-weight="bold">C</text>
                <text x="100" y="315" font-size="24" font-weight="bold">D</text>
            </svg>
        </div>

        <div class="content-box">
            <div class="items-pool" id="pool"></div>
            <div class="dropzone-grid">
                <div class="dropzone" data-type="dinh"><h4>Đỉnh</h4></div>
                <div class="dropzone" data-type="canh"><h4>Cạnh</h4></div>
                <div class="dropzone" data-type="cheo"><h4>Đường chéo</h4></div>
                <div class="dropzone" data-type="goc"><h4>Góc</h4></div>
                <div class="dropzone" data-type="canhdoi"><h4>Cặp cạnh đối</h4></div>
                <div class="dropzone" data-type="gocdoi"><h4>Cặp góc đối</h4></div>
            </div>
            <button onclick="checkResult()">KIỂM TRA KẾT QUẢ</button>
            <div id="msg"></div>
        </div>
    </div>
</div>

<script>
    // Hàm tạo ký tự có dấu mũ trắng
    const renderGoc = (text) => `<span class="goc-wrapper"><span class="goc-hat">^</span>${text}</span>`;
    
    const itemsData = [
        {id: 'A', t: 'A', g: 'dinh', svg: ['svg-A']}, {id: 'B', t: 'B', g: 'dinh', svg: ['svg-B']},
        {id: 'C', t: 'C', g: 'dinh', svg: ['svg-C']}, {id: 'D', t: 'D', g: 'dinh', svg: ['svg-D']},
        {id: 'AB', t: 'AB', g: 'canh', svg: ['svg-AB']}, {id: 'BC', t: 'BC', g: 'canh', svg: ['svg-BC']},
        {id: 'CD', t: 'CD', g: 'canh', svg: ['svg-CD']}, {id: 'DA', t: 'DA', g: 'canh', svg: ['svg-DA']},
        {id: 'AC', t: 'AC', g: 'cheo', svg: ['svg-AC']}, {id: 'BD', t: 'BD', g: 'cheo', svg: ['svg-BD']},
        {id: 'g1', t: renderGoc('DAB'), g: 'goc', svg: ['svg-AB', 'svg-DA']},
        {id: 'g2', t: renderGoc('ABC'), g: 'goc', svg: ['svg-AB', 'svg-BC']},
        {id: 'g3', t: renderGoc('BCD'), g: 'goc', svg: ['svg-BC', 'svg-CD']},
        {id: 'g4', t: renderGoc('CDA'), g: 'goc', svg: ['svg-CD', 'svg-DA']},
        {id: 'cd1', t: 'AB và CD', g: 'canhdoi', svg: ['svg-AB', 'svg-CD']},
        {id: 'cd2', t: 'BC và DA', g: 'canhdoi', svg: ['svg-BC', 'svg-DA']},
        {id: 'gd1', t: `${renderGoc('DAB')} và ${renderGoc('BCD')}`, g: 'gocdoi', svg: ['svg-A', 'svg-C']},
        {id: 'gd2', t: `${renderGoc('ABC')} và ${renderGoc('CDA')}`, g: 'gocdoi', svg: ['svg-B', 'svg-D']}
    ];

    const pool = document.getElementById('pool');
    itemsData.sort(() => Math.random() - 0.5).forEach(item => {
        const div = document.createElement('div');
        div.className = 'draggable';
        div.draggable = true;
        div.innerHTML = item.t;
        div.id = item.id;
        div.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text', div.id);
            div.classList.remove('correct', 'wrong');
        });
        pool.appendChild(div);
    });

    [...document.querySelectorAll('.dropzone'), pool].forEach(zone => {
        zone.addEventListener('dragover', e => e.preventDefault());
        zone.addEventListener('drop', e => {
            e.preventDefault();
            const id = e.dataTransfer.getData('text');
            zone.appendChild(document.getElementById(id));
        });
    });

    function checkResult() {
        // Reset all SVG styles
        document.querySelectorAll('line, circle').forEach(el => el.classList.remove('hl-active', 'hl-point-active', 'hl-diag-active'));

        let correctCount = 0;
        itemsData.forEach(data => {
            const el = document.getElementById(data.id);
            const parent = el.parentElement;
            
            if (parent.dataset.type === data.g) {
                el.classList.add('correct');
                correctCount++;
                // Chỉ Highline những cái ĐÚNG
                data.svg.forEach(sId => {
                    const svgEl = document.getElementById(sId);
                    if (svgEl.tagName === 'circle') svgEl.classList.add('hl-point-active');
                    else if (sId.includes('AC') || sId.includes('BD')) svgEl.classList.add('hl-diag-active');
                    else svgEl.classList.add('hl-active');
                });
            } else if (parent.id !== 'pool') {
                el.classList.add('wrong');
            }
        });

        const msg = document.getElementById('msg');
        msg.innerHTML = correctCount === itemsData.length ? 
            "<span style='color:#28a745'>Tuyệt vời! Bạn đã nhận diện đúng tất cả thành phần!</span>" : 
            `<span style='color:#dc3545'>Bạn đã đúng ${correctCount}/${itemsData.length}. Hãy kéo các thẻ đỏ về kho để làm lại.</span>`;
    }
</script>
</body>
</html>
